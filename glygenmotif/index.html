<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GlyGen Motif List</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.min.js"></script>
    <script src="content.js"></script>
</head>
<body>
<div id="hmm"></div>
<script>
    var container = document.getElementById("hmm");

    var ht = document.createElement("table");
    var dump = {};
    var rowNum = 0;
    for (var row of table) {
        var tr = document.createElement("tr");

        row.sort(function (x, y) {
            if (x.gtc < y.gtc) {
                return -1
            }
            if (x.gtc > y.gtc) {
                return 1
            }
        });
        rowNum += 1;
        var selection = document.createElement("td");
        var names = [];
        var accession = [];
        var redend = [true, false];
        var redendselect = {"t": 0, "f": 0};
        var aglycon = [];
        tr.innerText = rowNum;
        tr.appendChild(selection);
        for (var cell of row) {
            var td = document.createElement("td");

            var figure = document.createElement("figure");
            var img = document.createElement("img");
            var caption = document.createElement("figcaption");

            //img.src = "https://edwardslab.bmcb.georgetown.edu/~nedwards/dropbox/q4dRFkWJuM/image/red-extended-checked/" + cell.gtc + ".png";
            //img.src = "https://glytoucan.org/glycans/"+ cell.gtc +"/image?style=extended&format=png&notation=cfg";
            img.src = "./img/" + cell.gtc + ".jpg";
            img.width = 200;
            img.setAttribute("data-gtc", cell.gtc);
            img.onclick = function () {
                var e = this;
                window.open("https://glytoucan.org/Structures/Glycans/" + e.getAttribute("data-gtc"));
                // window.open("https://glytoucan.org/glycans/" + e.getAttribute("data-gtc") +"/image?style=extended&format=png&notation=cfg");
            };
            if (!names.includes(cell.name)) {
                names.push(cell.name);
            }
            if (!accession.includes(cell.gtc)) {
                accession.push(cell.gtc);
            }
            if (!aglycon.includes(cell.agly)) {
                aglycon.push(cell.agly);
            }
            if (cell.red) {
                redendselect["t"] += 1
            } else {
                redendselect["f"] += 1
            }

            var s = cell.col + "-" + cell.gtc + "\n" + cell.name + "\n" + cell.red + "," + cell.agly;
            caption.innerText = s;
            caption.setAttribute("style", "text-align: center;");

            figure.appendChild(img);
            figure.appendChild(caption);
            td.appendChild(figure);
            tr.appendChild(td);
        }

        for (var acc of accession) {
            var radio = document.createElement("input");
            var txt = document.createElement("span");
            radio.setAttribute("type", "radio");
            radio.setAttribute("name", rowNum + "accession");
            radio.setAttribute("value", acc);
            var c = rowNum + "-accession-" + acc;
            radio.setAttribute("command", c);
            txt.innerHTML = acc;
            radio.onclick = function (ev) {
                var c = this.getAttribute("command");
                var num = parseInt(c.split("-")[0]);
                var attr = c.split("-")[1];
                var value = c.split("-")[2];
                if (!dump[num]) {
                    dump[num] = {};
                }
                dump[num][attr] = value;
            };
            if (accession.length == 1) {
                radio.checked = true;
                radio.click();
            }

            selection.appendChild(radio);
            selection.appendChild(txt);
            selection.appendChild(document.createElement("br"));
        }
        selection.appendChild(document.createElement("br"));

        for (var name of names) {
            var radio = document.createElement("input");
            var txt = document.createElement("span");
            radio.setAttribute("type", "radio");
            radio.setAttribute("name", rowNum + "name");
            radio.setAttribute("value", name);
            txt.innerHTML = name;
            var c = rowNum + "-name-" + name;
            radio.setAttribute("command", c);
            radio.onclick = function (ev) {
                var c = this.getAttribute("command");
                var num = parseInt(c.split("-")[0]);
                var attr = c.split("-")[1];
                var value = c.split("-")[2];
                if (!dump[num]) {
                    dump[num] = {};
                }
                dump[num][attr] = value;
            };
            if (names.length == 1) {
                radio.checked = true;
                radio.click();
            }

            selection.appendChild(radio);
            selection.appendChild(txt);
            selection.appendChild(document.createElement("br"));
        }
        selection.appendChild(document.createElement("br"));

        for (var red of redend) {
            var radio = document.createElement("input");
            var txt = document.createElement("span");
            radio.setAttribute("type", "radio");
            radio.setAttribute("name", rowNum + "redend");
            radio.setAttribute("value", red);
            txt.innerHTML = red;
            if (redendselect["t"] > redendselect["f"] && red) {
                radio.checked = true;
                radio.click();
            }
            if (redendselect["t"] <= redendselect["f"] && !red) {
                radio.checked = true;
                radio.click();
            }
            var c = rowNum + "-red-" + red;
            radio.setAttribute("command", c);
            radio.onclick = function (ev) {
                var c = this.getAttribute("command");
                var num = parseInt(c.split("-")[0]);
                var attr = c.split("-")[1];
                var value = c.split("-")[2];
                if (!dump[num]) {
                    dump[num] = {};
                }
                dump[num][attr] = value;
            };

            selection.appendChild(radio);
            selection.appendChild(txt);
            selection.appendChild(document.createElement("br"));
        }
        selection.appendChild(document.createElement("br"));

        for (var agly of aglycon) {
            var radio = document.createElement("input");
            var txt = document.createElement("span");
            radio.setAttribute("type", "radio");
            radio.setAttribute("name", rowNum + "aglycon");
            radio.setAttribute("value", agly);
            txt.innerHTML = agly;
            var c = rowNum + "-aglycon-" + agly;
            radio.setAttribute("command", c);
            radio.onclick = function (ev) {
                var c = this.getAttribute("command");
                var num = parseInt(c.split("-")[0]);
                var attr = c.split("-")[1];
                var value = c.split("-")[2];
                if (!dump[num]) {
                    dump[num] = {};
                }
                dump[num][attr] = value;
            };
            if (aglycon.length == 1) {
                radio.checked = true;
                radio.click();
            }

            selection.appendChild(radio);
            selection.appendChild(txt);
            selection.appendChild(document.createElement("br"));
        }
        selection.setAttribute("style", "border: 5px solid lightgrey;");

        ht.appendChild(tr);
    }
    container.appendChild(ht);

    var save = document.createElement("button");
    save.innerText = "Save to console";
    save.onclick = function (ev) {
        console.clear();
        var notSelect = [];
        for (var i = 1; i <= rowNum; i++) {
            if (!Object.keys(dump).includes(i.toString())) {
                notSelect.push(i);
            } else {
                var warning = "";
                if (!Object.keys(dump[i]).includes("accession")) {
                    warning += " accession"
                }
                if (!Object.keys(dump[i]).includes("name")) {
                    warning += " name"
                }
                if (!Object.keys(dump[i]).includes("aglycon")) {
                    warning += " aglycon"
                }
                if (warning) {
                    console.log("Row:" + i + warning + " are not included")
                }
            }
        }
        if (notSelect.length > 0) {
            console.log(notSelect);
        }
        console.log(JSON.stringify(dump));
    };
    container.appendChild(save);

</script>

</body>
</html>